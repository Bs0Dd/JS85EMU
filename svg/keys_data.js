function uniqueFromTwoArrays(arr1, arr2) {
	var output = [];
	for(var x = 0; x < arr1.length; x++)
		if(output.indexOf(arr1[x]==-1)) output.push(arr1[x]);

	for(var x = 0; x < arr2.length; x++)
		if(output.indexOf(arr2[x]==-1)) output.push(arr2[x]);

	return output;
}

function keysRead(rows) {
	// rows a.k.a. CPU parallel port output
	
	var lastElem = uniquesPressed[uniquesPressed.length-1];
	
	var k = ((typeof lastElem != 'undefined')&&(lastElem in keyTable))?keyTable[lastElem]:keyTable["nokey"];

	var cols = ((rows&2)?k[0]:0)|((rows&4)?k[1]:0)|((rows&8)?k[2]:0);
	if((rows&2)&&(lastElem=="stop")) 
	{
		MK85CPU.flag_halt = true;
		console.log("HALT");
	}
	
	return cols;
}

var keyboardMapping = {
	q:0x51,
	w:0x57,
	e:0x45,
	r:0x52,
	t:0x54,
	y:0x59,
	u:0x55,
	i:0x49,
	o:0x4f,
	p:0x50,
	
	a:0x41,
	s:0x53,
	d:0x44,
	f:0x46,
	g:0x47,
	h:0x48,
	j:0x4a,
	k:0x4b,
	l:0x4c,
	ans:0x3b,
	
	z:0x5a,
	x:0x58,
	c:0x43,
	v:0x56,
	b:0x42,
	n:0x4e,
	m:0x4d,
	spc:0x20,
	eq:0xbc,
	ee:0xbe,

	ac:0x08,
	del:0x2e,
	stop:0x26,
	div:0xdb,

	n1:0x31,
	n2:0x32,
	n3:0x33,
	n4:0x34,
	n5:0x35,
	n6:0x36,
	n7:0x37,
	n8:0x38,
	n9:0x39,
	n0:0x30,
	
	add:0x3d,
	sub:0xad,
	mul:0xdd,
	
	exe:0x0d,
	dot:0xdc,

	mode:0x2d,
	arrow_l:0x25,
	arrow_r:0x27,
	mode_s:0x10,
	mode_f:0x11,
	
	init:0x1b,
	powersw:0xc0
	
};

var numpadKeyboardMapping = {
	n1:0x61,
	n2:0x62,
	n3:0x63,
	n4:0x64,
	n5:0x65,
	n6:0x66,
	n7:0x67,
	n8:0x68,
	n9:0x69,
	n0:0x60,

	add:0x6b,
	sub:0x6d,
	mul:0x6a,
	div:0x6f,
	dot:0x6c
}

var keyTable = {
	nokey:		[0x0000,0x0000,0x0000],
	powersw:	[0x0000,0x0000,0x0000],

	mode:		[0x0000,0x000C,0x0000],
	arrow_l:	[0x0000,0x0014,0x0000],
	arrow_r:	[0x0000,0x0018,0x0000],
	mode_s:		[0x0000,0x0024,0x0000],
	mode_f:		[0x0000,0x0028,0x0000],
	
	q:			[0x0000,0x0000,0x0044],
	w:			[0x0000,0x0000,0x000c],
	e:			[0x0000,0x0000,0x0018],
	r:			[0x0000,0x0000,0x0090],
	t:			[0x0000,0x0000,0x00a0],
	y:			[0x0000,0x0030,0x0000],
	u:			[0x0000,0x0044,0x0000],
	i:			[0x0000,0x0048,0x0000],
	o:			[0x0000,0x0050,0x0000],
	p:			[0x0000,0x0060,0x0000],

	a:			[0x0000,0x0000,0x0088],
	s:			[0x0000,0x0000,0x0014],
	d:			[0x0000,0x0000,0x0050],
	f:			[0x0000,0x0000,0x0024],
	g:			[0x0000,0x0000,0x0028],
	h:			[0x0000,0x0084,0x0000],
	j:			[0x0000,0x0088,0x0000],
	k:			[0x0000,0x0090,0x0000],
	l:			[0x0000,0x00a0,0x0000],
	ans:		[0x0000,0x00c0,0x0000],
	
	z:			[0x0000,0x0000,0x0030],
	x:			[0x0000,0x0000,0x0048],
	c:			[0x0000,0x0000,0x0084],
	v:			[0x0000,0x0000,0x00c0],
	b:			[0x0000,0x0000,0x0060],
	n:			[0x0000,0x0108,0x0000],
	m:			[0x0000,0x0104,0x0000],
	spc:		[0x0000,0x0110,0x0000],
	eq:			[0x0000,0x0120,0x0000],
	ee:			[0x0000,0x0140,0x0000],
	
	ac:			[0x000c,0x0000,0x0000],
	del:		[0x0014,0x0000,0x0000],
	stop:		[0x0000,0x0000,0x0000],
	div:		[0x0024,0x0000,0x0000],
	n7:			[0x0028,0x0000,0x0000],
	n8:			[0x0030,0x0000,0x0000],
	n9:			[0x0044,0x0000,0x0000],
	mul:		[0x0048,0x0000,0x0000],
	n4:			[0x0050,0x0000,0x0000],
	n5:			[0x0060,0x0000,0x0000],
	n6:			[0x0084,0x0000,0x0000],
	sub:		[0x0088,0x0000,0x0000],
	n1:			[0x0090,0x0000,0x0000],
	n2:			[0x00a0,0x0000,0x0000],
	n3:			[0x00c0,0x0000,0x0000],
	add:		[0x0104,0x0000,0x0000],
	n0:			[0x0108,0x0000,0x0000],
	dot:		[0x0110,0x0000,0x0000],
	exe:		[0x0120,0x0000,0x0000],
	
	init:		[0x0018,0x0000,0x0000],
};



var faceKeys = {

	init:{type:0, posCode:0x03},
	mode:{type:0, posCode:0x05},
	arrow_l:{type:0, posCode:0x06},
	arrow_r:{type:0, posCode:0x07},
	mode_s:{type:0, posCode:0x08},
	mode_f:{type:0, posCode:0x09},

	q:{type:0, posCode:0x10},
	w:{type:0, posCode:0x11},
	e:{type:0, posCode:0x12},
	r:{type:0, posCode:0x13},
	t:{type:0, posCode:0x14},
	y:{type:0, posCode:0x15},
	u:{type:0, posCode:0x16},
	i:{type:0, posCode:0x17},
	o:{type:0, posCode:0x18},
	p:{type:0, posCode:0x19},

	a:{type:0, posCode:0x20},
	s:{type:0, posCode:0x21},
	d:{type:0, posCode:0x22},
	f:{type:0, posCode:0x23},
	g:{type:0, posCode:0x24},
	h:{type:0, posCode:0x25},
	j:{type:0, posCode:0x26},
	k:{type:0, posCode:0x27},
	l:{type:0, posCode:0x28},
	ans:{type:0, posCode:0x29},

	z:{type:0, posCode:0x30},
	x:{type:0, posCode:0x31},
	c:{type:0, posCode:0x32},
	v:{type:0, posCode:0x33},
	b:{type:0, posCode:0x34},
	n:{type:0, posCode:0x35},
	m:{type:0, posCode:0x36},
	spc:{type:0, posCode:0x37},
	eq:{type:0, posCode:0x38},
	ee:{type:0, posCode:0x39},
	
	ac  :{type:1, posCode:0x00},
	del :{type:1, posCode:0x01},
	stop:{type:1, posCode:0x02},
	div :{type:1, posCode:0x03},
	mul :{type:1, posCode:0x13},
	sub :{type:1, posCode:0x23},
	add :{type:1, posCode:0x33},
	dot :{type:1, posCode:0x41},
	exe :{type:1, posCode:0x42, doubleWidth:true},
	n0  :{type:1, posCode:0x40},
	n1  :{type:1, posCode:0x30},
	n2  :{type:1, posCode:0x31},
	n3  :{type:1, posCode:0x32},
	n4  :{type:1, posCode:0x20},
	n5  :{type:1, posCode:0x21},
	n6  :{type:1, posCode:0x22},
	n7  :{type:1, posCode:0x10},
	n8  :{type:1, posCode:0x11},
	n9  :{type:1, posCode:0x12},
	
	
};

var blockTypes = [
	{off_x:23, mul_x:52, off_y:158, mul_y:42},
	{off_x:545, mul_x:51, off_y: 159-76, mul_y:49}
];
